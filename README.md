
# Обработка исключений

**Исключения** являются механизмом обработки ошибок и необычных ситуаций, которые могут возникнуть во время выполнения программы. Когда возникает исключительная ситуация, создаётся объект исключения и передаётся через вызывающие методы до тех пор, пока не найдется соответствующий обработчик исключений.

Исключения позволяют:

- отделить обработку ошибок от нормального потока выполнения программы;
- обеспечить структурированный подход к обработке ошибок;
- "нормализованно" прерывать выполнение методов и механизмов.

В Java есть разные типы исключений, такие как **проверяемые (checked)** и **непроверяемые (unchecked)** исключения. _Проверяемые_ исключения должны быть явно объявлены в сигнатуре метода или обработаны с помощью блока **`try-catch`**, в то время как _непроверяемые_ исключения могут быть необъявленными или необработанными.

Здесь представлены два задания, затрагивающие тему исключений:
1. Реализация терминала банкомата для одного аккаунта.
2. Отображение в консоли содержимого сайта по вводимому url.

####
При запуске программы можно выбрать, какое из заданий запустить:
![menu](https://github.com/MironovNikita/sber-homework4/blob/main/res/task1/menu.png)




## Задание №1

Реализовать интерфейс Terminal, c помощью которого можно:
- проверить состояние счёта;
- снять/положить деньги.

Доступ к терминалу (терминал для одного счёта) предоставляется только после ввода корректного пин-кода (__4 цифры__). Каждое нажатие должно восприниматься системой как ввод очередного символа пин-кода.

При вводе нецифрового символа система должна выдать предупреждение, но при этом данное действие __не считается критичной ошибкой__ ввода и состояние системы должно восстановиться к последнему корректному состоянию.

При вводе 3 неправильных пин-кодов аккаунт _блокируется_ на 10 сек (при попытке обратиться к нему в течение этого времени должно вызываться исключение **`AccountIsLockedException`** c информацией об оставшемся времени до снятия блокировки).
Класть и снимать деньги можно только, _если сумма кратна **100**_.

Поскольку банкоматы, установленные на улице, сами «ничего не делают» с вашим счётом (они лишь делают проверку введенных данных и отправляют запросы на удаленный сервер), то сервер (`TerminalServer`) может вызывать свои исключения, например, при недостатке средств на счёте для совершения операции. 
 
Класс терминал может содержать следующие поля:
```java
class TerminalImpl {
    private final TerminalServer server;
    private final PinValidator pinValidator; 
   ...
}
```
Часть команд терминал делегирует этим классам.
 
Интерфейс терминала и список исключений остается на ваш дизайн. В каждом ексепшене должно быть описание, что нужно сделать, чтобы избежать его в дальнейшем.
`TerminalServer` и `PinValidator` могут кидать свои собственные исключения. Конечный пользователь не должен видеть эти исключения, ему должны показываться человеко-читабельные сообщения об ошибках.

Логика по показу сообщений конечному пользователю и бизнес логика терминала с обработкой исключений должна быть в разных классах, чтобы можно было легко менять интрефейс вывода сообщений (на консоль, через графический интерфейс и т.д.)

## Описание результатов

При выборе 1 задания из меню мы попадаем в терминал банкомата, который запрашивает наш пин-код. За авторизацию отвечает класс `PinValidator`. В случае попыток ввести неверный пин-код программа будет предупреждать нас о возможной блокировке. Если мы исчерпаем все попытки, терминал заблокируется. При этом, даже если ввести __верный__ пин-код во время блокировки, система нас не пропустит. При введении нецифровых символов также вычитается одна попытка ввода пин-кода.

Пример работы программы при неверном пин-коде (`верный код:` **`1574`**):
![invalidPin](https://github.com/MironovNikita/sber-homework4/blob/main/res/task1/invalidPin.png)

В самом терминале есть небольшое меню (на скриншоте выше), где по вводу цифрового значения предусмотрена дальнейшая работа с программой. В случае ввода иных символов будет выводиться ошибка (в любом месте работы с терминалом): 
![menuNavigation](https://github.com/MironovNikita/sber-homework4/blob/main/res/task1/menuNavigation.png)

Перейдём к основным функциям терминала. Постараемся пополнить его нецифровыми символами и на отрицательную сумму:
![deposit](https://github.com/MironovNikita/sber-homework4/blob/main/res/task1/deposit.png)

В случае успешного пополнения (в примере это 1500 и 1700 руб.), получаем сообщения:
```java
========================================================
Успешно! Сумма 1500 руб. внесена!
Ваш текущий баланс: 1500,00 руб.
========================================================
-/-
========================================================
Успешно! Сумма 1700 руб. внесена!
Ваш текущий баланс: 3200,00 руб.
========================================================
```

Пополнение прошло успешно! Теперь проверим наш баланс:
![balanceAfterDeposit](https://github.com/MironovNikita/sber-homework4/blob/main/res/task1/balanceAfterDeposit.png)

При снятии средств также проверим терминал на возможные ошибки и после снимем со счёта `3000 руб.`:
![withdrawal](https://github.com/MironovNikita/sber-homework4/blob/main/res/task1/withdrawal.png)

```java
Введите сумму (кратно 100): 
3000
Направляю запрос на сервер...

========================================================
Успешно! Возьмите Ваши деньги!
Ваш текущий баланс: 200,00 руб.
========================================================
```

Снятие прошло успешно! Теперь проверим наш баланс:
![balanceAfterWithdrawal](https://github.com/MironovNikita/sber-homework4/blob/main/res/task1/balanceAfterWithdrawal.png)

В целом мы видели изменения на нашем балансе при любой операции. Но нужно было проверить, что наш баланс на сервере действительно изменился.
```java
Выбрано: проверить баланс
Направляю запрос на сервер...
========================================================
Ваш текущий баланс: 200,00 руб.
========================================================
```

Список исключений, предусмотренных в данной программе:
- **`AccountsLockedException`** - исключение, вызываемое при блокировке аккаунта;
- **`IncorrectSumException`** - исключение, вызываемое при вводе некорректной сумме снятия/пополнения счёта;
- **`NotEnoughFundsException`** - исключение, вызываемое при недостаточном количестве средств на счёте.

## Задание №2

Реализуйте метод **`readContent(String url)`**, который отображает на экран содержимое сайта, ссылка на который задаётся параметром url. Напишите программу, считывающую из консоли строку (`URL ресурса`) и вызывающую метод **`readContent`**. В том случае, если введённый `URL` _неправильного_ формата или нет доступа до указанного ресурса, пользователю предлагается повторить ввод.

## Описание результатов

Для выполнения данного задания был создан класс **`UrlReader`** с двумя статическими методами:
- **`public static String acceptUrl()`** - принимает вводимую строку и проверяет её;
- **`public static void readContent(String url)`** - считывает данные сайта по принятому `URL`.

В методе `readContent(String url)` создаётся объект класса `URL` - представляет собой единый указатель ресурса, указатель на "ресурс" во Всемирной паутине. Далее мы "открываем" соединение через `URLConnection`. Абстрактный класс `URLConnection` является суперклассом всех классов, которые представляют канал связи между приложением и `URL`. Экземпляры этого класса могут использоваться как для чтения, так и для записи в ресурс, на который ссылается `URL.`

Далее производится стандартное "считывание" содержимого сайта через объект класса `BufferedReader` и выводится в консоль.

Результат выполнения запроса к сайту **`https://ya.ru`** (показан частично):

![urlReader](https://github.com/MironovNikita/sber-homework2/blob/main/res/task2/urlReader.png)

В случае, если методу поступит некорректный URL или такого сайта не существует, приложение выведет соответствующие ошибки:

![exceptions](https://github.com/MironovNikita/sber-homework2/blob/main/res/task2/exceptions.png)


## Вопросы для самоконтроля

1.	Правильно ли написан следующий код:
```java
try {

} finally {

}
```

**Ответ**: Да. Блок `try` может быть без блока `catch`. После выхода из `try` выполнится блок `finally`. Данная реализация может быть полезна, если при выходе из метода нужно осуществить какое-либо действие. В таком случае основной код метода пойдёт в `try`, а выполняемый при выходе - в `finally`.


2. Какие исключения могут быть перехвачены следующим обработчиком:
```java
catch (Exception e) {

}
```
Что не так с использованием такого обработчика?

**Ответ**: Данный обработчик перехватывает все исключения типа `Exception` и его подклассы. Данный обработчик затруднит отладку программы и обнаружение проблем в ней. Лучше использовать более конкретизированное перехватывание исключений.

3. Имеется ли ошибка в написании такого обработчика исключения? Скомпилируется ли этот код? 
```java
try {

} catch (Exception e) {
    
} catch (ArithmeticException a) {
    
}
```

**Ответ**: Да, в написании обработчика есть ошибка. В случае обработки нескольких исключений в блоке `catch` они должны быть размещены в порядке от наиболее конкретного исключения к наиболее общему. В данном коде исключение ArithmeticException более конкретное, чем Exception, поэтому должно быть размещено перед ним. Если код будет с текущим порядком обработки исключений, будет возникать ошибка компиляции.

4. Сопоставьте каждую ситуацию из первого списка с пунктом второго списка:
- а) int[] A; A[0] = 0;
- б) JVM начинает запускать вашу программу, но обнаруживает, что не может найти классы Java платформы;
- в) программа читает входной поток и достигает маркера конца потока;
- г) после достижения маркера конца входного потока, но до закрытия самого потока, программа пытаться считать данные.

1. ошибка;
2. проверяемое исключение;
3. ошибка компиляции;
4. исключение не произойдёт.

####
Ответ: 
| Условие                                                                                                            | Результат                   |
|--------------------------------------------------------------------------------------------------------------------|-----------------------------|
| а) int[] A; A[0] = 0;                                                                                              | 3. ошибка компиляции        |
| б) JVM начинает запускать вашу программу, но обнаруживает, что не может найти классы Java платформы                | 1. ошибка                   |
| в) программа читает входной поток и достигает маркера конца потока                                                 | 4. исключение не произойдёт |
| г) после достижения маркера конца входного потока, но до закрытия самого потока, программа пытаться считать данные | 2. проверяемое исключение   |





